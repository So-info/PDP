<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>FitMotiv ‚Ä¢ Noir & Orange</title>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <style>
    :root{
      --bg:#050505;
      --bg2:#0B0B0B;

      --card: rgba(255,255,255,.06);
      --stroke: rgba(255,255,255,.10);

      --txt:#F3F3F3;
      --muted: rgba(243,243,243,.72);
      --muted2: rgba(243,243,243,.50);

      --orange:#FF7A00;
      --orange2:#FF9A3D;

      --danger:#FF3B30;
      --shadow: 0 18px 60px rgba(0,0,0,.65);

      --radius: 18px;
      --radius2: 22px;

      --safe-bottom: env(safe-area-inset-bottom, 0px);
      --safe-top: env(safe-area-inset-top, 0px);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-rounded, system-ui, -apple-system, "SF Pro Display","SF Pro Text", Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      color:var(--txt);
      background:
        radial-gradient(900px 520px at 20% 0%, rgba(255,122,0,.14), transparent 55%),
        radial-gradient(700px 450px at 85% 15%, rgba(255,154,61,.09), transparent 55%),
        linear-gradient(180deg, var(--bg), var(--bg2));
      overflow-x:hidden;
    }

    .app{
      max-width: 480px;
      margin: 0 auto;
      min-height: 100vh;
      padding: calc(16px + var(--safe-top)) 16px calc(104px + var(--safe-bottom));
    }

    /* Top */
    .topbar{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      margin-bottom: 14px;
    }
    .brand .title{
      font-weight: 950;
      letter-spacing: .2px;
      font-size: 22px;
      line-height: 1.05;
    }
    .brand .subtitle{
      margin-top:4px;
      font-size: 12.5px;
      color: var(--muted2);
      line-height: 1.15rem;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding: 10px 12px;
      background: rgba(255,255,255,.05);
      border: 1px solid var(--stroke);
      border-radius: 999px;
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      font-size: 12.5px;
      color: var(--muted);
      user-select:none;
      white-space:nowrap;
    }
    .dot{
      width:10px;height:10px;border-radius:50%;
      background: var(--orange);
      box-shadow: 0 0 0 4px rgba(255,122,0,.18);
    }

    /* Cards */
    .grid{display:grid; gap: 12px;}
    .card{
      border-radius: var(--radius2);
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.05));
      border: 1px solid var(--stroke);
      box-shadow: var(--shadow);
      padding: 14px;
      position:relative;
      overflow:hidden;
    }
    .card::before{
      content:"";
      position:absolute;
      inset:-1px;
      background:
        radial-gradient(420px 220px at 15% 0%, rgba(255,122,0,.10), transparent 60%);
      pointer-events:none;
    }
    .card > *{position:relative}

    .h2{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin: 0 0 10px 0;
      font-size: 14px;
      font-weight: 950;
      letter-spacing: .25px;
    }
    .small{font-size: 12px; color: var(--muted2);}

    /* Inputs (global) */
    label{display:block; font-size: 12px; color: var(--muted); margin-bottom:6px;}
    input{
      width:100%;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.22);
      color: var(--txt);
      outline:none;
      font-size: 14px;
    }
    input:focus{
      border-color: rgba(255,122,0,.65);
      box-shadow: 0 0 0 4px rgba(255,122,0,.16);
    }

    /* Buttons */
    .btn{
      border:none;
      cursor:pointer;
      padding: 12px 14px;
      border-radius: 16px;
      font-weight: 950;
      letter-spacing: .2px;
      font-size: 14px;
      color:#111;
      background: linear-gradient(135deg, var(--orange), var(--orange2));
      box-shadow: 0 16px 34px rgba(255,122,0,.18);
      transition: transform .08s ease, filter .2s ease, opacity .2s ease;
      user-select:none;
      width:100%;
    }
    .btn:active{transform: scale(.985)}
    .btn.secondary{
      background: rgba(255,255,255,.06);
      color: var(--txt);
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: none;
    }
    .btn.danger{
      background: rgba(255,59,48,.14);
      color: rgba(255,255,255,.92);
      border: 1px solid rgba(255,59,48,.30);
      box-shadow:none;
    }
    .btn.ghost{
      background: transparent;
      color: var(--muted);
      border: 1px solid rgba(255,255,255,.10);
      box-shadow:none;
      font-weight: 900;
    }

    .hint{
      margin-top: 10px;
      color: var(--muted2);
      font-size: 12px;
      line-height: 1.25rem;
    }

    .actions2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin-top:10px;
    }

    /* Lists */
    .list{margin: 10px 0 0 0; padding:0; list-style:none; display:flex; flex-direction:column; gap:10px;}
    .item{
      display:flex;
      gap:10px;
      padding: 12px;
      border-radius: var(--radius);
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      align-items:flex-start;
    }
    .badge{
      width:36px;height:36px;border-radius: 12px;
      display:flex;align-items:center;justify-content:center;
      background: rgba(255,122,0,.12);
      border: 1px solid rgba(255,122,0,.22);
      flex: 0 0 auto;
      font-size: 16px;
    }
    .t{font-weight: 950; font-size: 13.5px; margin:0;}
    .d{margin: 3px 0 0 0; color: var(--muted); font-size: 12.7px; line-height: 1.25rem;}
    .chips{margin-top:8px; display:flex; gap:8px; flex-wrap:wrap;}
    .chip{
      font-size: 11.5px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.10);
      color: var(--muted2);
    }

    /* Chart */
    .chartWrap{
      margin-top: 10px;
      padding: 12px;
      border-radius: var(--radius);
      background: rgba(0,0,0,.22);
      border: 1px solid rgba(255,255,255,.10);
      height: 230px;
    }
    .mutebar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(255,255,255,.04);
      border: 1px solid rgba(255,255,255,.08);
      color: var(--muted2);
      font-size: 12px;
    }

    .tools{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      margin-top: 10px;
    }
    .tools .field{flex: 1 1 160px; min-width: 160px;}

    /* Sections */
    .section{display:none}
    .section.active{display:block}

    /* Bottom tabs */
    .tabs{
      position: fixed;
      left: 0; right: 0; bottom: 0;
      padding: 10px 14px calc(10px + var(--safe-bottom));
      background: rgba(0,0,0,.55);
      border-top: 1px solid rgba(255,255,255,.08);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      z-index: 30;
    }
    .tabsInner{
      width: min(480px, 100%);
      margin: 0 auto;
      display:flex;
      gap: 10px;
    }
    .tabBtn{
      flex:1;
      border:none;
      cursor:pointer;
      padding: 10px 12px;
      border-radius: 16px;
      background: rgba(255,255,255,.04);
      border: 1px solid rgba(255,255,255,.08);
      color: var(--muted2);
      font-weight: 950;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      user-select:none;
      transition: transform .08s ease, background .2s ease, color .2s ease, border-color .2s ease;
    }
    .tabBtn:active{transform:scale(.99)}
    .tabBtn.active{
      color: var(--txt);
      border-color: rgba(255,122,0,.28);
      background: rgba(255,122,0,.10);
      box-shadow: 0 12px 30px rgba(255,122,0,.10);
    }
    .tabIco{
      width:28px;height:28px;border-radius: 12px;
      display:flex;align-items:center;justify-content:center;
      background: rgba(255,255,255,.04);
      border: 1px solid rgba(255,255,255,.08);
      font-size: 15px;
    }
    .tabBtn.active .tabIco{
      background: rgba(255,122,0,.14);
      border-color: rgba(255,122,0,.25);
    }

    /* Edit sheet */
    .backdrop{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,.62);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      display:none;
      align-items:flex-end;
      justify-content:center;
      padding: 16px 16px calc(16px + var(--safe-bottom));
      z-index: 60;
    }
    .backdrop.show{display:flex}
    .sheet{
      width: min(480px, 100%);
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.05));
      box-shadow: 0 30px 90px rgba(0,0,0,.70);
      overflow:hidden;
    }
    .sheetHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding: 14px 14px 10px;
      border-bottom: 1px solid rgba(255,255,255,.08);
    }
    .sheetHeader .h{font-weight: 950;}
    .sheetBody{padding: 14px;}
    .sheetFooter{
      display:flex;
      gap:10px;
      padding: 12px 14px 14px;
      border-top: 1px solid rgba(255,255,255,.08);
    }
    .sheetFooter button{flex:1}

    ::selection{background: rgba(255,122,0,.28);}

    /* ----------------------------
       Pes√©e du jour (v4) ‚Äì refaite
       ---------------------------- */
    .weighCard .head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom: 12px;
    }
    .weighCard .head .title{
      font-size: 15px;
      font-weight: 950;
      letter-spacing: .2px;
      margin:0;
    }
    .weighCard .dateChip{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 8px 10px;
      border-radius: 999px;
      background: rgba(255,122,0,.10);
      border: 1px solid rgba(255,122,0,.22);
      color: rgba(243,243,243,.92);
      font-size: 12px;
      white-space:nowrap;
    }
    .weighCard .dateChip .miniDot{
      width:8px;height:8px;border-radius:50%;
      background: var(--orange);
      box-shadow: 0 0 0 3px rgba(255,122,0,.18);
    }

    .inputGroup{
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      overflow:hidden;
    }
    .inputRow{
      display:flex;
      align-items:stretch;
    }
    .inputRow .cell{
      flex:1;
      padding: 10px 12px 12px;
      position:relative;
    }
    .inputRow .cell + .cell{
      border-left: 1px solid rgba(255,255,255,.08);
    }
    .inputGroup .label2{
      display:flex;
      align-items:center;
      gap:8px;
      font-size: 12px;
      color: var(--muted2);
      margin: 0 0 6px;
    }
    .inputGroup .label2 .ic{
      width:22px;height:22px;border-radius: 10px;
      display:flex;align-items:center;justify-content:center;
      background: rgba(255,122,0,.10);
      border: 1px solid rgba(255,122,0,.18);
      font-size: 12px;
    }
    .inputGroup input{
      border: none !important;
      background: rgba(0,0,0,.18) !important;
      padding: 12px 12px !important;
      border-radius: 14px !important;
    }
    .inputGroup input:focus{
      box-shadow: 0 0 0 4px rgba(255,122,0,.14) !important;
    }

    .weightWrap{position:relative;}
    .weightWrap .unit{
      position:absolute;
      right: 14px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 12px;
      color: rgba(243,243,243,.45);
      pointer-events:none;
    }
    .weightWrap input{ padding-right: 42px !important; }

    .weighPrimary{
      margin-top: 12px;
      border-radius: 18px;
      padding: 13px 14px;
      background: linear-gradient(135deg, rgba(255,122,0,1), rgba(255,154,61,1));
      box-shadow:
        0 16px 36px rgba(255,122,0,.18),
        inset 0 1px 0 rgba(255,255,255,.25);
    }
    .weighPrimary:active{ transform: scale(.985); }

    .kpisClean{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 12px;
    }
    .kpiClean{
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      padding: 12px;
    }
    .kpiClean .v{
      font-weight: 950;
      font-size: 18px;
      letter-spacing: .2px;
    }
    .kpiClean .l{
      margin-top: 4px;
      font-size: 12px;
      color: var(--muted2);
    }
    .kpiClean.good .v{ color: rgba(255,154,61,.95); }
    .kpiClean.neutral .v{ color: rgba(243,243,243,.92); }
  </style>
</head>

<body>
  <div class="app">
    <div class="topbar">
      <div class="brand">
        <div class="title">FitMotiv</div>
        <div class="subtitle">Noir & Orange ‚Ä¢ Suivi poids ‚Ä¢ Repas ‚Ä¢ Motivation</div>
      </div>
      <div class="pill" title="S√©rie de jours cons√©cutifs avec une pes√©e">
        <span class="dot"></span>
        <span><b id="streak">0</b> jour(s)</span>
      </div>
    </div>

    <!-- ACCUEIL -->
    <section id="home" class="section active">
      <div class="grid">

        <!-- Pes√©e du jour (refaite) -->
        <div class="card weighCard">
          <div class="head">
            <p class="title">Pes√©e du jour</p>
            <div class="dateChip">
              <span class="miniDot"></span>
              <span id="todayLabel">‚Äî</span>
            </div>
          </div>

          <div class="inputGroup">
            <div class="inputRow">
              <div class="cell">
                <div class="label2"><span class="ic">üìÖ</span> Date</div>
                <input id="dateInput" type="date" />
              </div>

              <div class="cell">
                <div class="label2"><span class="ic">‚öñÔ∏è</span> Poids</div>
                <div class="weightWrap">
                  <input id="weightInput" type="number" inputmode="decimal" step="0.1" placeholder="ex: 78.4" />
                  <span class="unit">kg</span>
                </div>
              </div>
            </div>
          </div>

          <button class="btn weighPrimary" id="saveBtn">Enregistrer</button>

          <div class="kpisClean">
            <div class="kpiClean neutral">
              <div class="v" id="kpiLast">‚Äî</div>
              <div class="l">Derni√®re pes√©e</div>
            </div>
            <div class="kpiClean good">
              <div class="v" id="kpiDelta">‚Äî</div>
              <div class="l">√âvolution (vs 1√®re)</div>
            </div>
          </div>

          <p class="hint">√âpur√© = efficace. Tu notes, tu suis, tu avances.</p>

          <div class="actions2">
            <button class="btn secondary" id="exportJsonBtn">Exporter JSON</button>
            <button class="btn secondary" id="exportCsvBtn">Exporter CSV</button>
            <button class="btn ghost" id="importBtn">Importer JSON</button>
            <button class="btn danger" id="clearBtn">Tout effacer</button>
          </div>
          <input id="importFile" type="file" accept="application/json" style="display:none;" />
        </div>

        <!-- √âvolution + logs -->
        <div class="card">
          <div class="h2">
            <span>√âvolution</span>
            <span class="small" id="rangeLabel">‚Äî</span>
          </div>

          <div class="chartWrap">
            <canvas id="weightChart"></canvas>
          </div>

          <div class="mutebar">
            <span>Min: <b id="minW">‚Äî</b> ‚Ä¢ Max: <b id="maxW">‚Äî</b></span>
            <span>Entr√©es: <b id="countW">0</b></span>
          </div>

          <div class="tools">
            <div class="field">
              <label for="searchInput">Rechercher (date ou poids)</label>
              <input id="searchInput" placeholder="ex: 2026-01 ou 78.4" />
            </div>
            <div class="field">
              <label for="sortSelect">Tri</label>
              <input id="sortSelect" list="sortOptions" placeholder="Date (r√©cent ‚Üí ancien)" />
              <datalist id="sortOptions">
                <option value="Date (r√©cent ‚Üí ancien)"></option>
                <option value="Date (ancien ‚Üí r√©cent)"></option>
                <option value="Poids (haut ‚Üí bas)"></option>
                <option value="Poids (bas ‚Üí haut)"></option>
              </datalist>
            </div>
          </div>

          <ul class="list" id="historyList"></ul>
        </div>
      </div>
    </section>

    <!-- REPAS -->
    <section id="meals" class="section">
      <div class="grid">
        <div class="card">
          <div class="h2">
            <span>Repas simples</span>
            <span class="small">prot√©ines + l√©gumes</span>
          </div>
          <ul class="list" id="mealList"></ul>
          <p class="hint">Simple, r√©p√©table, efficace. C‚Äôest la r√©gularit√© qui gagne.</p>
        </div>
      </div>
    </section>

    <!-- MOTIVATION -->
    <section id="motivation" class="section">
      <div class="grid">
        <div class="card">
          <div class="h2">
            <span>Motivation</span>
            <span class="small">constance</span>
          </div>

          <div class="item">
            <div class="badge">üî•</div>
            <div>
              <p class="t" id="quote">‚Äî</p>
              <p class="d" id="quoteSub">‚Äî</p>
              <div class="chips">
                <span class="chip">Discipline</span>
                <span class="chip">Mental</span>
                <span class="chip">Routine</span>
              </div>
            </div>
          </div>

          <div style="height:10px"></div>

          <div class="item">
            <div class="badge">‚úÖ</div>
            <div style="width:100%">
              <p class="t">Checklist du jour</p>
              <div class="d">
                <label style="display:flex; gap:10px; align-items:center; margin:10px 0 0;">
                  <input type="checkbox" id="c1" style="width:18px;height:18px;"> 20‚Äì30 min de marche
                </label>
                <label style="display:flex; gap:10px; align-items:center; margin:10px 0 0;">
                  <input type="checkbox" id="c2" style="width:18px;height:18px;"> Prot√©ines + l√©gumes √† 1 repas
                </label>
                <label style="display:flex; gap:10px; align-items:center; margin:10px 0 0;">
                  <input type="checkbox" id="c3" style="width:18px;height:18px;"> Sommeil un peu plus t√¥t
                </label>
              </div>

              <div class="actions2" style="margin-top:12px">
                <button class="btn secondary" id="newQuoteBtn">Nouvelle punchline</button>
                <button class="btn ghost" id="resetChecksBtn">Reset checklist</button>
              </div>
            </div>
          </div>

          <p class="hint">Ta meilleure forme se construit par r√©p√©tition.</p>
        </div>
      </div>
    </section>
  </div>

  <!-- Bottom tabs -->
  <nav class="tabs" aria-label="Navigation">
    <div class="tabsInner">
      <button class="tabBtn active" data-tab="home">
        <span class="tabIco">üìà</span><span>Accueil</span>
      </button>
      <button class="tabBtn" data-tab="meals">
        <span class="tabIco">ü•ó</span><span>Repas</span>
      </button>
      <button class="tabBtn" data-tab="motivation">
        <span class="tabIco">üèãÔ∏è</span><span>Motivation</span>
      </button>
    </div>
  </nav>

  <!-- Edit sheet -->
  <div class="backdrop" id="editBackdrop" role="dialog" aria-modal="true">
    <div class="sheet">
      <div class="sheetHeader">
        <div class="h">Modifier une entr√©e</div>
        <button class="btn ghost" id="closeEditBtn" style="width:auto;padding:8px 12px;border-radius:14px;">Fermer</button>
      </div>
      <div class="sheetBody">
        <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:flex-end;">
          <div style="flex:1 1 140px; min-width:140px;">
            <label for="editDate">Date</label>
            <input id="editDate" type="date" />
          </div>
          <div style="flex:1 1 140px; min-width:140px;">
            <label for="editWeight">Poids (kg)</label>
            <input id="editWeight" type="number" step="0.1" inputmode="decimal" />
          </div>
        </div>
        <p class="hint" style="margin-bottom:0;">Tap sur une ligne des logs pour modifier/supprimer.</p>
      </div>
      <div class="sheetFooter">
        <button class="btn danger" id="deleteEntryBtn">Supprimer</button>
        <button class="btn" id="saveEditBtn">Enregistrer</button>
      </div>
    </div>
  </div>

  <script>
    // Helpers
    const $ = (s)=>document.querySelector(s);
    const $$ = (s)=>Array.from(document.querySelectorAll(s));
    const pad = (n)=>String(n).padStart(2,"0");
    const todayISO = ()=>{
      const d=new Date();
      return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
    };
    const fmtDate = (iso)=>{
      if(!iso) return "‚Äî";
      const [y,m,d]=iso.split("-").map(Number);
      return new Date(y,m-1,d).toLocaleDateString("fr-FR",{weekday:"short",year:"numeric",month:"short",day:"2-digit"});
    };
    const prevDayISO = (iso)=>{
      const [y,m,d]=iso.split("-").map(Number);
      const dt=new Date(y,m-1,d); dt.setDate(dt.getDate()-1);
      return `${dt.getFullYear()}-${pad(dt.getMonth()+1)}-${pad(dt.getDate())}`;
    };

    // Storage
    const KEY="fitmotiv.weights.darkorange.v2";
    const CK ="fitmotiv.checks.darkorange.v2";

    const loadEntries=()=>{
      try{
        const raw=localStorage.getItem(KEY);
        const arr=raw?JSON.parse(raw):[];
        return Array.isArray(arr)?arr.filter(e=>e&&e.date&&typeof e.weight==="number"):[];
      }catch{return[]}
    };
    const saveEntries=(entries)=>localStorage.setItem(KEY, JSON.stringify(entries));

    const normalize=(entries)=>{
      const map=new Map();
      entries.forEach(e=>map.set(e.date,{date:e.date, weight:Number(e.weight)}));
      const out=[...map.values()].filter(e=>e.date && Number.isFinite(e.weight) && e.weight>0);
      out.sort((a,b)=>a.date.localeCompare(b.date));
      return out;
    };

    const upsertEntry=(entries,date,weight)=>{
      const i=entries.findIndex(e=>e.date===date);
      if(i>=0) entries[i].weight=weight;
      else entries.push({date,weight});
      return normalize(entries);
    };
    const deleteEntry=(entries,date)=>entries.filter(e=>e.date!==date);

    const clearAll=()=>{
      localStorage.removeItem(KEY);
      localStorage.removeItem(CK);
    };

    // Meals
    const meals=[
      { icon:"üêü", title:"Poisson + l√©gumes surgel√©s", desc:"Colin/saumon + brocoli/haricots verts.", tags:["Rapide","Prot√©ines"] },
      { icon:"üçó", title:"Poulet + salade", desc:"Blanc de poulet + crudit√©s + sauce yaourt.", tags:["Lean","Sati√©t√©"] },
      { icon:"üç≥", title:"Omelette + √©pinards", desc:"≈íufs + √©pinards surgel√©s + champignons.", tags:["10 min","Budget"] },
      { icon:"ü•£", title:"Bol thon express", desc:"Thon + skyr + moutarde + cornichons.", tags:["Sans cuisson","Prot√©in√©"] },
      { icon:"ü¶É", title:"Dinde + wok", desc:"Dinde + wok surgel√© + sauce soja light.", tags:["Sport","Go√ªt"] },
      { icon:"üç≤", title:"Soupe + ≈ìufs durs", desc:"Soupe l√©gumes + 2 ≈ìufs durs.", tags:["Volume","Light"] },
      { icon:"üßÄ", title:"Skyr + fruits", desc:"Skyr nature + fruits rouges (portion).", tags:["Sucr√© malin"] },
    ];
    const renderMeals=()=>{
      const ul=$("#mealList"); ul.innerHTML="";
      meals.forEach(m=>{
        const li=document.createElement("li");
        li.className="item";
        li.innerHTML=`
          <div class="badge">${m.icon}</div>
          <div>
            <p class="t">${m.title}</p>
            <p class="d">${m.desc}</p>
            <div class="chips">${m.tags.map(t=>`<span class="chip">${t}</span>`).join("")}</div>
          </div>`;
        ul.appendChild(li);
      });
    };

    // Motivation
    const quotes=[
      {q:"R√©gulier > parfait.", s:"Aujourd‚Äôhui : fais simple, fais-le."},
      {q:"La discipline bat la motivation.", s:"M√™me 15 minutes comptent."},
      {q:"Tu construis ton futur toi.", s:"Un choix √† la fois."},
      {q:"Constance = r√©sultats.", s:"R√©p√®te les basiques."},
      {q:"Tu n‚Äôas pas besoin d‚Äô√™tre pr√™t(e).", s:"Tu as besoin de commencer."},
    ];
    const pickQuote=()=>{
      const x=quotes[Math.floor(Math.random()*quotes.length)];
      $("#quote").textContent=x.q; $("#quoteSub").textContent=x.s;
    };

    // Checklist
    const loadChecks=()=>{
      try{
        const raw=localStorage.getItem(CK);
        return raw?JSON.parse(raw):{c1:false,c2:false,c3:false,date:todayISO()};
      }catch{return{c1:false,c2:false,c3:false,date:todayISO()}}
    };
    const saveChecks=(o)=>localStorage.setItem(CK, JSON.stringify(o));

    const initChecks=()=>{
      let st=loadChecks();
      const t=todayISO();
      if(st.date!==t){ st={c1:false,c2:false,c3:false,date:t}; saveChecks(st); }
      ["c1","c2","c3"].forEach(id=>{
        const el=$("#"+id);
        el.checked=!!st[id];
        el.addEventListener("change", ()=>{
          const cur=loadChecks();
          cur[id]=el.checked; cur.date=todayISO();
          saveChecks(cur);
        });
      });
      $("#resetChecksBtn").addEventListener("click", ()=>{
        const st2={c1:false,c2:false,c3:false,date:todayISO()};
        saveChecks(st2);
        ["c1","c2","c3"].forEach(id=>$("#"+id).checked=false);
      });
    };

    // Chart
    let chart;
    const makeOrangeGradient=(ctx)=>{
      const g=ctx.createLinearGradient(0,0,0,240);
      g.addColorStop(0, "rgba(255,122,0,0.35)");
      g.addColorStop(0.55, "rgba(255,122,0,0.10)");
      g.addColorStop(1, "rgba(0,0,0,0)");
      return g;
    };

    const buildChart=(entries)=>{
      const canvas=$("#weightChart");
      const ctx=canvas.getContext("2d");
      const labels=entries.map(e=>e.date);
      const data=entries.map(e=>e.weight);

      let min=Math.min(...data,0), max=Math.max(...data,0);
      if(data.length){
        const p=Math.max(0.6,(max-min)*0.18);
        min=Math.floor((min-p)*10)/10;
        max=Math.ceil((max+p)*10)/10;
      }

      if(chart) chart.destroy();
      chart=new Chart(canvas,{
        type:"line",
        data:{
          labels,
          datasets:[{
            data,
            tension:0.38,
            borderWidth:3,
            pointRadius:3.6,
            pointHoverRadius:6,
            fill:true,
            backgroundColor: makeOrangeGradient(ctx),
            borderColor:"rgba(255,122,0,0.98)",
            pointBackgroundColor:"rgba(255,154,61,0.98)",
            pointBorderColor:"rgba(0,0,0,0)",
          }]
        },
        options:{
          responsive:true,
          maintainAspectRatio:false,
          plugins:{
            legend:{display:false},
            tooltip:{
              backgroundColor:"rgba(0,0,0,.92)",
              borderColor:"rgba(255,255,255,.10)",
              borderWidth:1,
              titleColor:"rgba(243,243,243,.95)",
              bodyColor:"rgba(243,243,243,.85)",
              displayColors:false,
              callbacks:{
                title:(items)=>items?.[0]?.label?fmtDate(items[0].label):"",
                label:(item)=>` ${item.formattedValue} kg`
              }
            }
          },
          scales:{
            x:{
              ticks:{color:"rgba(243,243,243,.55)", maxTicksLimit:6},
              grid:{color:"rgba(255,255,255,.05)"}
            },
            y:{
              suggestedMin: data.length?min:undefined,
              suggestedMax: data.length?max:undefined,
              ticks:{color:"rgba(243,243,243,.55)"},
              grid:{color:"rgba(255,255,255,.05)"}
            }
          }
        }
      });
    };

    // Logs / stats
    const computeStreak=(entries)=>{
      if(!entries.length) return 0;
      const set=new Set(entries.map(e=>e.date));
      let cur=set.has(todayISO())?todayISO():entries.at(-1).date;
      let s=0;
      while(set.has(cur)){ s++; cur=prevDayISO(cur); }
      return s;
    };

    const stats=(entries)=>{
      if(!entries.length) return {min:null,max:null};
      let mn=entries[0].weight, mx=entries[0].weight;
      for(const e of entries){ if(e.weight<mn) mn=e.weight; if(e.weight>mx) mx=e.weight; }
      return {min:mn,max:mx};
    };

    const getFilteredSorted=(entries)=>{
      const q=($("#searchInput").value||"").trim().toLowerCase();
      let out=entries;
      if(q){
        out=out.filter(e=>e.date.toLowerCase().includes(q) || String(e.weight).toLowerCase().includes(q));
      }
      const sortLabel=($("#sortSelect").value || "Date (r√©cent ‚Üí ancien)").trim();
      const byDateAsc=(a,b)=>a.date.localeCompare(b.date);
      const byDateDesc=(a,b)=>b.date.localeCompare(a.date);
      const byWAsc=(a,b)=>a.weight-b.weight;
      const byWDesc=(a,b)=>b.weight-a.weight;

      if(sortLabel==="Date (ancien ‚Üí r√©cent)") out=[...out].sort(byDateAsc);
      else if(sortLabel==="Poids (haut ‚Üí bas)") out=[...out].sort(byWDesc);
      else if(sortLabel==="Poids (bas ‚Üí haut)") out=[...out].sort(byWAsc);
      else out=[...out].sort(byDateDesc);

      return out;
    };

    const renderHistory=(entries)=>{
      const last=entries.at(-1);
      const first=entries[0];

      $("#kpiLast").textContent = last ? `${last.weight.toFixed(1)} kg` : "‚Äî";
      if(last && first){
        const delta = last.weight - first.weight;
        const sign = delta > 0 ? "+" : "";
        $("#kpiDelta").textContent = `${sign}${delta.toFixed(1)} kg`;
      } else $("#kpiDelta").textContent="‚Äî";

      if(entries.length>=2) $("#rangeLabel").textContent=`${fmtDate(entries[0].date)} ‚Üí ${fmtDate(entries.at(-1).date)}`;
      else if(entries.length===1) $("#rangeLabel").textContent=fmtDate(entries[0].date);
      else $("#rangeLabel").textContent="Aucune donn√©e";

      $("#streak").textContent = computeStreak(entries);

      const s=stats(entries);
      $("#minW").textContent = s.min==null ? "‚Äî" : `${s.min.toFixed(1)} kg`;
      $("#maxW").textContent = s.max==null ? "‚Äî" : `${s.max.toFixed(1)} kg`;
      $("#countW").textContent = String(entries.length);

      const ul=$("#historyList"); ul.innerHTML="";
      const shown=getFilteredSorted(entries);

      if(!shown.length){
        const li=document.createElement("li");
        li.className="item";
        li.innerHTML=`<div class="badge">üîé</div><div><p class="t">Aucune entr√©e</p><p class="d">Ajoute une pes√©e ou change la recherche.</p></div>`;
        ul.appendChild(li);
        return;
      }

      shown.forEach(e=>{
        const isLatest = (entries.at(-1)?.date === e.date);
        const li=document.createElement("li");
        li.className="item";
        li.innerHTML=`
          <div class="badge">${isLatest?"‚≠ê":"üìå"}</div>
          <div style="flex:1;">
            <p class="t">${fmtDate(e.date)}</p>
            <p class="d"><b style="color:rgba(243,243,243,.95)">${e.weight.toFixed(1)} kg</b></p>
            <div class="chips">
              <span class="chip">${e.date}</span>
              <span class="chip">Tap pour modifier</span>
            </div>
          </div>`;
        li.addEventListener("click", ()=> openEditSheet(e.date));
        ul.appendChild(li);
      });
    };

    const refresh=()=>{
      const entries = loadEntries().sort((a,b)=>a.date.localeCompare(b.date));
      buildChart(entries);
      renderHistory(entries);
    };

    // Home actions
    const initHome=()=>{
      const t=todayISO();
      $("#dateInput").value=t;
      $("#todayLabel").textContent=fmtDate(t);

      $("#dateInput").addEventListener("change", ()=> $("#todayLabel").textContent=fmtDate($("#dateInput").value));
      $("#searchInput").addEventListener("input", refresh);
      $("#sortSelect").addEventListener("input", refresh);

      $("#saveBtn").addEventListener("click", ()=>{
        const date=$("#dateInput").value || todayISO();
        const w=Number($("#weightInput").value);
        if(!date){ alert("Choisis une date."); return; }
        if(!Number.isFinite(w) || w<=0){ alert("Entre un poids valide (ex: 78.4)."); return; }

        const entries = upsertEntry(loadEntries(), date, Math.round(w*10)/10);
        saveEntries(entries);

        $("#weightInput").value="";
        refresh();

        const btn=$("#saveBtn");
        const old=btn.textContent;
        btn.textContent="Enregistr√© ‚úÖ";
        setTimeout(()=>btn.textContent=old, 900);
      });

      $("#clearBtn").addEventListener("click", ()=>{
        if(!confirm("Tout effacer ? (pes√©es + checklist)")) return;
        clearAll();
        refresh();
        initChecks();
      });

      $("#exportJsonBtn").addEventListener("click", ()=>{
        const entries=loadEntries();
        const blob=new Blob([JSON.stringify(entries,null,2)],{type:"application/json"});
        const url=URL.createObjectURL(blob);
        const a=document.createElement("a");
        a.href=url; a.download="fitmotiv-poids.json";
        document.body.appendChild(a); a.click(); a.remove();
        URL.revokeObjectURL(url);
      });

      $("#exportCsvBtn").addEventListener("click", ()=>{
        const entries=loadEntries().sort((a,b)=>a.date.localeCompare(b.date));
        const csv="date,weight\n"+entries.map(e=>`${e.date},${e.weight}`).join("\n")+"\n";
        const blob=new Blob([csv],{type:"text/csv;charset=utf-8"});
        const url=URL.createObjectURL(blob);
        const a=document.createElement("a");
        a.href=url; a.download="fitmotiv-poids.csv";
        document.body.appendChild(a); a.click(); a.remove();
        URL.revokeObjectURL(url);
      });

      $("#importBtn").addEventListener("click", ()=>$("#importFile").click());
      $("#importFile").addEventListener("change", async (ev)=>{
        const file=ev.target.files?.[0];
        if(!file) return;
        try{
          const text=await file.text();
          const data=JSON.parse(text);
          if(!Array.isArray(data)) throw new Error("bad");
          const merged=normalize([...loadEntries(), ...data]);
          saveEntries(merged);
          refresh();
          alert("Import r√©ussi ‚úÖ");
        }catch{
          alert("Import impossible. Fichier JSON invalide.");
        }finally{
          ev.target.value="";
        }
      });
    };

    // Tabs
    const initTabs=()=>{
      $$(".tabBtn").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          $$(".tabBtn").forEach(b=>b.classList.remove("active"));
          btn.classList.add("active");
          const id=btn.dataset.tab;
          $$(".section").forEach(s=>s.classList.remove("active"));
          $("#"+id).classList.add("active");
        });
      });
    };

    // Edit sheet
    let editOriginalDate=null;

    const openEditSheet=(date)=>{
      const entries=loadEntries();
      const e=entries.find(x=>x.date===date);
      if(!e) return;
      editOriginalDate=date;
      $("#editDate").value=e.date;
      $("#editWeight").value=e.weight.toFixed(1);
      $("#editBackdrop").classList.add("show");
    };

    const closeEditSheet=()=>{
      $("#editBackdrop").classList.remove("show");
      editOriginalDate=null;
    };

    const initEditSheet=()=>{
      $("#closeEditBtn").addEventListener("click", closeEditSheet);
      $("#editBackdrop").addEventListener("click", (ev)=>{
        if(ev.target.id==="editBackdrop") closeEditSheet();
      });

      $("#saveEditBtn").addEventListener("click", ()=>{
        const newDate=$("#editDate").value;
        const newW=Number($("#editWeight").value);
        if(!newDate){ alert("Choisis une date."); return; }
        if(!Number.isFinite(newW)||newW<=0){ alert("Poids invalide."); return; }

        let entries=loadEntries();
        if(editOriginalDate) entries=deleteEntry(entries, editOriginalDate);
        entries=upsertEntry(entries, newDate, Math.round(newW*10)/10);
        saveEntries(entries);

        closeEditSheet();
        refresh();
      });

      $("#deleteEntryBtn").addEventListener("click", ()=>{
        if(!editOriginalDate) return;
        if(!confirm("Supprimer cette entr√©e ?")) return;
        let entries=loadEntries();
        entries=deleteEntry(entries, editOriginalDate);
        saveEntries(entries);
        closeEditSheet();
        refresh();
      });
    };

    // Boot
    renderMeals();
    pickQuote();
    $("#newQuoteBtn").addEventListener("click", pickQuote);

    initTabs();
    initHome();
    initChecks();
    initEditSheet();
    refresh();
  </script>
</body>
</html>