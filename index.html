<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FitMotiv ‚Ä¢ Suivi</title>

  <!-- Chart.js (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <style>
    :root{
      --bg0:#070A12;
      --bg1:#0B1020;
      --card: rgba(255,255,255,.08);
      --card2: rgba(255,255,255,.10);
      --stroke: rgba(255,255,255,.12);
      --txt:#F3F6FF;
      --muted: rgba(243,246,255,.75);
      --muted2: rgba(243,246,255,.55);
      --accent:#7C5CFF;
      --accent2:#2EE59D;
      --danger:#FF4D6D;
      --shadow: 0 18px 60px rgba(0,0,0,.55);
      --radius: 18px;
      --radius2: 26px;
      --safe-bottom: env(safe-area-inset-bottom, 0px);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-rounded, system-ui, -apple-system, "SF Pro Display","SF Pro Text", Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      color:var(--txt);
      background:
        radial-gradient(900px 600px at 15% 10%, rgba(124,92,255,.30), transparent 55%),
        radial-gradient(900px 600px at 85% 15%, rgba(46,229,157,.18), transparent 55%),
        radial-gradient(900px 600px at 60% 90%, rgba(255,77,109,.12), transparent 55%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow-x:hidden;
    }

    /* App frame */
    .app{
      max-width: 460px;
      margin: 0 auto;
      min-height: 100vh;
      padding: 18px 16px calc(96px + var(--safe-bottom));
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-top: 8px;
      margin-bottom: 14px;
    }

    .brand{
      display:flex;
      flex-direction:column;
      gap:3px;
    }
    .brand .title{
      font-weight: 850;
      letter-spacing: .2px;
      font-size: 20px;
      line-height: 1.05;
    }
    .brand .subtitle{
      font-size: 12.5px;
      color: var(--muted);
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 10px 12px;
      background: rgba(255,255,255,.06);
      border: 1px solid var(--stroke);
      border-radius: 999px;
      box-shadow: 0 12px 30px rgba(0,0,0,.25);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      font-size: 12.5px;
      color: var(--muted);
      user-select:none;
    }
    .dot{
      width:10px;height:10px;border-radius:50%;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      box-shadow: 0 0 0 4px rgba(124,92,255,.18);
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      border: 1px solid var(--stroke);
      border-radius: var(--radius2);
      box-shadow: var(--shadow);
      padding: 14px;
      position:relative;
      overflow:hidden;
    }

    .card::before{
      content:"";
      position:absolute;
      inset:-2px;
      background:
        radial-gradient(380px 200px at 20% 0%, rgba(124,92,255,.22), transparent 60%),
        radial-gradient(380px 200px at 90% 30%, rgba(46,229,157,.14), transparent 60%);
      pointer-events:none;
    }
    .card > *{position:relative}

    .h2{
      font-size: 14px;
      letter-spacing:.25px;
      font-weight: 800;
      margin: 0 0 10px 0;
      color: var(--txt);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }

    .small{
      font-size: 12px;
      color: var(--muted2);
    }

    .row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }

    label{
      display:block;
      font-size: 12px;
      color: var(--muted);
      margin-bottom:6px;
    }

    .field{
      flex:1 1 130px;
      min-width: 130px;
    }

    input{
      width:100%;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      color: var(--txt);
      outline:none;
      font-size: 14px;
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.12);
    }
    input:focus{
      border-color: rgba(124,92,255,.55);
      box-shadow: 0 0 0 4px rgba(124,92,255,.18);
    }

    .btn{
      border:none;
      cursor:pointer;
      padding: 12px 14px;
      border-radius: 16px;
      font-weight: 850;
      letter-spacing: .2px;
      font-size: 14px;
      color:#0B1020;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      box-shadow: 0 14px 30px rgba(124,92,255,.22);
      transition: transform .08s ease, filter .2s ease;
      user-select:none;
      width:100%;
    }
    .btn:active{transform: scale(.98)}
    .btn.secondary{
      background: rgba(255,255,255,.08);
      color: var(--txt);
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: 0 14px 30px rgba(0,0,0,.18);
    }
    .btn.danger{
      background: rgba(255,77,109,.16);
      color: #FFD5DE;
      border: 1px solid rgba(255,77,109,.25);
      box-shadow:none;
    }

    .kpis{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 10px;
    }
    .kpi{
      padding: 12px;
      border-radius: var(--radius);
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
    }
    .kpi .v{
      font-size: 18px;
      font-weight: 900;
      letter-spacing:.2px;
    }
    .kpi .l{
      font-size: 12px;
      color: var(--muted2);
      margin-top: 2px;
    }

    .list{
      margin: 10px 0 0 0;
      padding:0;
      list-style:none;
      display:flex;
      flex-direction:column;
      gap:10px;
    }

    .item{
      display:flex;
      gap:10px;
      padding: 12px;
      border-radius: var(--radius);
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      align-items:flex-start;
    }
    .badge{
      width:34px;height:34px;border-radius: 12px;
      display:flex;align-items:center;justify-content:center;
      background: linear-gradient(135deg, rgba(124,92,255,.35), rgba(46,229,157,.25));
      border: 1px solid rgba(255,255,255,.14);
      flex: 0 0 auto;
    }
    .item .t{
      font-weight: 850;
      font-size: 13.5px;
      margin:0;
    }
    .item .d{
      margin: 3px 0 0 0;
      color: var(--muted);
      font-size: 12.5px;
      line-height: 1.25rem;
    }
    .chips{
      margin-top:8px;
      display:flex;gap:8px;flex-wrap:wrap;
    }
    .chip{
      font-size: 11.5px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      color: var(--muted);
    }

    .chartWrap{
      margin-top: 10px;
      padding: 12px;
      border-radius: var(--radius);
      background: rgba(0,0,0,.18);
      border: 1px solid rgba(255,255,255,.12);
    }

    .hint{
      margin-top: 10px;
      color: var(--muted2);
      font-size: 12px;
      line-height: 1.25rem;
    }

    /* Tabs (bottom) */
    .tabs{
      position: fixed;
      left: 0; right: 0; bottom: 0;
      padding: 10px 14px calc(10px + var(--safe-bottom));
      background: rgba(10,14,28,.65);
      border-top: 1px solid rgba(255,255,255,.12);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      display:flex;
      justify-content:center;
      z-index: 30;
    }
    .tabsInner{
      width: min(460px, 100%);
      display:flex;
      gap: 10px;
    }
    .tabBtn{
      flex:1;
      border:none;
      cursor:pointer;
      padding: 10px 12px;
      border-radius: 18px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.12);
      color: var(--muted);
      font-weight: 850;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      transition: filter .2s ease, transform .08s ease;
    }
    .tabBtn:active{transform:scale(.99)}
    .tabBtn.active{
      background: linear-gradient(135deg, rgba(124,92,255,.35), rgba(46,229,157,.25));
      color: var(--txt);
      border-color: rgba(255,255,255,.16);
      box-shadow: 0 14px 30px rgba(0,0,0,.25);
    }
    .ico{font-size: 16px}

    .section{display:none}
    .section.active{display:block}

    .split{
      display:grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }

    .footerActions{
      display:flex;
      gap:10px;
      margin-top:10px;
    }
    .footerActions > button{flex:1}

    /* iPhone-ish spacing */
    .spacer{height:6px}
  </style>
</head>

<body>
  <div class="app">
    <div class="topbar">
      <div class="brand">
        <div class="title">FitMotiv</div>
        <div class="subtitle">Suivi poids ‚Ä¢ repas simples ‚Ä¢ motivation</div>
      </div>
      <div class="pill" id="streakPill" title="S√©rie de jours avec une pes√©e">
        <span class="dot"></span>
        <span><span id="streak">0</span> jour(s) ‚Ä¢ r√©gularit√©</span>
      </div>
    </div>

    <!-- ACCUEIL -->
    <section id="home" class="section active">
      <div class="grid">
        <div class="card">
          <div class="h2">
            <span>Pes√©e du jour</span>
            <span class="small" id="todayLabel">‚Äî</span>
          </div>

          <div class="row">
            <div class="field">
              <label for="dateInput">Date</label>
              <input id="dateInput" type="date" />
            </div>
            <div class="field">
              <label for="weightInput">Poids (kg)</label>
              <input id="weightInput" type="number" inputmode="decimal" step="0.1" placeholder="ex: 78.4" />
            </div>
          </div>

          <div class="spacer"></div>

          <button class="btn" id="saveBtn">Enregistrer la pes√©e</button>

          <div class="kpis">
            <div class="kpi">
              <div class="v" id="kpiLast">‚Äî</div>
              <div class="l">Derni√®re pes√©e</div>
            </div>
            <div class="kpi">
              <div class="v" id="kpiDelta">‚Äî</div>
              <div class="l">√âvolution (vs 1√®re)</div>
            </div>
          </div>

          <p class="hint">Astuce : p√®se-toi au m√™me moment (ex : matin), et vise la r√©gularit√© plut√¥t que la perfection.</p>

          <div class="footerActions">
            <button class="btn secondary" id="exportBtn">Exporter (JSON)</button>
            <button class="btn danger" id="clearBtn">Tout effacer</button>
          </div>
        </div>

        <div class="card">
          <div class="h2">
            <span>√âvolution</span>
            <span class="small" id="rangeLabel">‚Äî</span>
          </div>
          <div class="chartWrap">
            <canvas id="weightChart" height="160"></canvas>
          </div>
          <ul class="list" id="historyList"></ul>
        </div>
      </div>
    </section>

    <!-- REPAS -->
    <section id="meals" class="section">
      <div class="grid">
        <div class="card">
          <div class="h2">
            <span>Repas simples & rapides</span>
            <span class="small">prot√©ines + l√©gumes</span>
          </div>

          <ul class="list" id="mealList"></ul>

          <p class="hint">
            Base ‚Äúperte de poids‚Äù : prot√©ines maigres (poisson/poulet/≈ìufs) + l√©gumes (surgel√©s OK) + f√©culents dos√©s (si besoin).
            Bois de l‚Äôeau, et garde des portions coh√©rentes.
          </p>
        </div>
      </div>
    </section>

    <!-- MOTIVATION -->
    <section id="motivation" class="section">
      <div class="grid">
        <div class="card">
          <div class="h2">
            <span>Motivation sport</span>
            <span class="small">petits pas ‚Üí gros r√©sultats</span>
          </div>

          <div class="item">
            <div class="badge">üî•</div>
            <div>
              <p class="t" id="quote">‚Äî</p>
              <p class="d" id="quoteSub">‚Äî</p>
              <div class="chips">
                <span class="chip">Discipline</span>
                <span class="chip">R√©gularit√©</span>
                <span class="chip">Sommeil</span>
              </div>
            </div>
          </div>

          <div class="split" style="margin-top:10px;">
            <div class="item">
              <div class="badge">‚úÖ</div>
              <div>
                <p class="t">Checklist du jour</p>
                <p class="d">
                  <label style="display:flex; gap:10px; align-items:center; margin:8px 0 0;">
                    <input type="checkbox" id="c1" style="width:18px;height:18px;"> 20‚Äì30 min de marche
                  </label>
                  <label style="display:flex; gap:10px; align-items:center; margin:8px 0 0;">
                    <input type="checkbox" id="c2" style="width:18px;height:18px;"> 1 portion de l√©gumes en plus
                  </label>
                  <label style="display:flex; gap:10px; align-items:center; margin:8px 0 0;">
                    <input type="checkbox" id="c3" style="width:18px;height:18px;"> Couch√©(e) un peu plus t√¥t
                  </label>
                </p>
              </div>
            </div>

            <button class="btn secondary" id="newQuoteBtn">Nouvelle punchline</button>
          </div>

          <p class="hint">
            Objectif : √™tre ‚Äúassez bon‚Äù 80% du temps. Une mauvaise journ√©e ne ruine pas ton plan ‚Äî abandonner oui.
          </p>
        </div>
      </div>
    </section>
  </div>

  <!-- Tabs -->
  <nav class="tabs" aria-label="Navigation">
    <div class="tabsInner">
      <button class="tabBtn active" data-tab="home"><span class="ico">üìà</span>Accueil</button>
      <button class="tabBtn" data-tab="meals"><span class="ico">ü•ó</span>Repas</button>
      <button class="tabBtn" data-tab="motivation"><span class="ico">üèãÔ∏è</span>Motivation</button>
    </div>
  </nav>

  <script>
    // ---------- Helpers ----------
    const $ = (sel) => document.querySelector(sel);
    const $$ = (sel) => Array.from(document.querySelectorAll(sel));
    const fmtDate = (iso) => {
      // iso: YYYY-MM-DD
      if(!iso) return "‚Äî";
      const [y,m,d] = iso.split("-").map(Number);
      const dt = new Date(y, (m-1), d);
      return dt.toLocaleDateString("fr-FR", { weekday:"short", year:"numeric", month:"short", day:"2-digit" });
    };
    const todayISO = () => {
      const d = new Date();
      const pad = (n) => String(n).padStart(2,"0");
      return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
    };

    // ---------- Storage ----------
    const KEY = "fitmotiv.weights.v1";
    const CK  = "fitmotiv.checks.v1";

    function loadEntries(){
      try{
        const raw = localStorage.getItem(KEY);
        const arr = raw ? JSON.parse(raw) : [];
        // normalize
        return Array.isArray(arr) ? arr.filter(e => e && e.date && typeof e.weight === "number") : [];
      }catch{ return []; }
    }

    function saveEntries(entries){
      localStorage.setItem(KEY, JSON.stringify(entries));
    }

    function upsertEntry(entries, date, weight){
      const i = entries.findIndex(e => e.date === date);
      if(i >= 0) entries[i].weight = weight;
      else entries.push({date, weight});
      entries.sort((a,b) => a.date.localeCompare(b.date));
      return entries;
    }

    function clearAll(){
      localStorage.removeItem(KEY);
      localStorage.removeItem(CK);
    }

    // ---------- Meals ----------
    const meals = [
      { icon:"üêü", title:"Poisson + l√©gumes surgel√©s", desc:"Saumon ou colin au four + po√™l√©e de l√©gumes (brocoli, haricots verts).", tags:["Rapide","Riche en prot√©ines","Omega-3"] },
      { icon:"üçó", title:"Poulet + salade croquante", desc:"Blanc de poulet (airfryer/po√™le) + salade + tomates + concombre + yaourt citron.", tags:["Simple","Faible en gras","Sati√©tant"] },
      { icon:"üç≥", title:"Omelette prot√©ines", desc:"2‚Äì3 ≈ìufs (ou 1 ≈ìuf + blancs) + √©pinards surgel√©s + champignons.", tags:["10 min","Budget","Anti-fringale"] },
      { icon:"ü•£", title:"Bol thon express", desc:"Thon nature + skyr/yaourt + moutarde + cornichons + crudit√©s.", tags:["Sans cuisson","Prot√©in√©","Pr√™t vite"] },
      { icon:"ü•©", title:"Steak hach√© 5% + l√©gumes", desc:"Steak 5% + ratatouille surgel√©e + √©pices (paprika, ail).", tags:["Sport","Tr√®s simple","Sati√©t√©"] },
      { icon:"ü¶É", title:"Dinde + wok de l√©gumes", desc:"√âminc√© de dinde + m√©lange wok surgel√© + sauce soja light.", tags:["Wok","Go√ªt","Lean"] },
      { icon:"üßÄ", title:"Skyr + fruits + noix (portion)", desc:"Skyr nature + fruits rouges + 10‚Äì15g de noix.", tags:["Petit-d√©j","Prot√©ines","Sucr√© malin"] },
      { icon:"üç≤", title:"Soupe + prot√©ines", desc:"Soupe de l√©gumes + ≈ìufs durs ou poulet effiloch√©.", tags:["Confort","Volume","Light"] },
    ];

    function renderMeals(){
      const ul = $("#mealList");
      ul.innerHTML = "";
      meals.forEach(m => {
        const li = document.createElement("li");
        li.className = "item";
        li.innerHTML = `
          <div class="badge">${m.icon}</div>
          <div>
            <p class="t">${m.title}</p>
            <p class="d">${m.desc}</p>
            <div class="chips">${m.tags.map(t => `<span class="chip">${t}</span>`).join("")}</div>
          </div>
        `;
        ul.appendChild(li);
      });
    }

    // ---------- Motivation ----------
    const quotes = [
      {q:"La motivation te lance. La discipline te transforme.", s:"Aujourd‚Äôhui : 1 action simple, pas 100 excuses."},
      {q:"Tu ne manques pas de temps. Tu manques de priorit√©.", s:"10 minutes suffisent pour gagner."},
      {q:"Ton futur toi te remercie d√©j√†.", s:"R√©p√®te les bons choix, m√™me petits."},
      {q:"R√©gulier > parfait.", s:"Objectif : coh√©rence, pas perfection."},
      {q:"Chaque s√©ance est un vote pour la personne que tu veux devenir.", s:"Vote aujourd‚Äôhui."},
      {q:"Le corps change quand l‚Äôesprit tient bon.", s:"Fais le prochain bon choix."},
      {q:"Tu ne perds pas du poids. Tu gagnes une vie.", s:"Un repas √† la fois, un jour √† la fois."},
    ];
    function pickQuote(){
      const x = quotes[Math.floor(Math.random()*quotes.length)];
      $("#quote").textContent = x.q;
      $("#quoteSub").textContent = x.s;
    }

    // Checklist persistence
    function loadChecks(){
      try{
        const raw = localStorage.getItem(CK);
        return raw ? JSON.parse(raw) : {c1:false,c2:false,c3:false, date: todayISO()};
      }catch{
        return {c1:false,c2:false,c3:false, date: todayISO()};
      }
    }
    function saveChecks(obj){ localStorage.setItem(CK, JSON.stringify(obj)); }

    function initChecks(){
      let st = loadChecks();
      const t = todayISO();
      // reset if new day
      if(st.date !== t){
        st = {c1:false,c2:false,c3:false, date:t};
        saveChecks(st);
      }
      ["c1","c2","c3"].forEach(id=>{
        const el = $("#"+id);
        el.checked = !!st[id];
        el.addEventListener("change", ()=>{
          const cur = loadChecks();
          cur[id] = el.checked;
          cur.date = todayISO();
          saveChecks(cur);
        });
      });
    }

    // ---------- Chart ----------
    let chart;

    function buildChart(entries){
      const ctx = $("#weightChart");
      const labels = entries.map(e => e.date);
      const data = entries.map(e => e.weight);

      const cfg = {
        type: "line",
        data: {
          labels,
          datasets: [{
            label: "Poids (kg)",
            data,
            tension: 0.35,
            borderWidth: 3,
            pointRadius: 3,
            pointHoverRadius: 5,
            fill: true,
            backgroundColor: "rgba(124,92,255,0.12)",
            borderColor: "rgba(124,92,255,0.95)",
            pointBackgroundColor: "rgba(46,229,157,0.95)",
            pointBorderColor: "rgba(0,0,0,0)",
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display:false },
            tooltip: {
              callbacks: {
                title: (items)=> items?.[0]?.label ? fmtDate(items[0].label) : "",
                label: (item)=> ` ${item.formattedValue} kg`
              }
            }
          },
          scales: {
            x: {
              ticks: {
                color: "rgba(243,246,255,.65)",
                maxTicksLimit: 6
              },
              grid: { color: "rgba(255,255,255,.06)" }
            },
            y: {
              ticks: { color: "rgba(243,246,255,.65)" },
              grid: { color: "rgba(255,255,255,.06)" }
            }
          }
        }
      };

      if(chart) chart.destroy();
      chart = new Chart(ctx, cfg);
    }

    // ---------- UI Rendering ----------
    function renderHistory(entries){
      const ul = $("#historyList");
      ul.innerHTML = "";

      const last = entries.at(-1);
      const first = entries[0];

      $("#kpiLast").textContent = last ? `${last.weight.toFixed(1)} kg` : "‚Äî";
      if(last && first){
        const delta = last.weight - first.weight;
        const sign = delta > 0 ? "+" : "";
        $("#kpiDelta").textContent = `${sign}${delta.toFixed(1)} kg`;
      } else {
        $("#kpiDelta").textContent = "‚Äî";
      }

      // Range label
      if(entries.length >= 2){
        $("#rangeLabel").textContent = `${fmtDate(entries[0].date)} ‚Üí ${fmtDate(entries.at(-1).date)}`;
      } else if(entries.length === 1){
        $("#rangeLabel").textContent = fmtDate(entries[0].date);
      } else {
        $("#rangeLabel").textContent = "Aucune donn√©e";
      }

      // Streak (days with weigh-in ending today if exists, otherwise ending at latest entry)
      const streak = computeStreak(entries);
      $("#streak").textContent = streak;

      // List latest first
      const rev = [...entries].reverse();
      rev.slice(0, 12).forEach((e, idx) => {
        const li = document.createElement("li");
        li.className = "item";
        const badge = idx === 0 ? "‚≠ê" : "üìå";
        li.innerHTML = `
          <div class="badge">${badge}</div>
          <div style="flex:1;">
            <p class="t">${fmtDate(e.date)}</p>
            <p class="d"><b style="color:rgba(243,246,255,.95)">${e.weight.toFixed(1)} kg</b></p>
          </div>
        `;
        ul.appendChild(li);
      });

      if(entries.length > 12){
        const li = document.createElement("li");
        li.className = "item";
        li.innerHTML = `
          <div class="badge">‚Ä¶</div>
          <div>
            <p class="t">${entries.length} entr√©es enregistr√©es</p>
            <p class="d">Le graphique affiche tout l‚Äôhistorique.</p>
          </div>
        `;
        ul.appendChild(li);
      }
    }

    function computeStreak(entries){
      if(!entries.length) return 0;
      // Use a set of dates
      const set = new Set(entries.map(e=>e.date));
      // base date: if today exists use today, else use latest date
      let cur = set.has(todayISO()) ? todayISO() : entries.at(-1).date;

      // walk backwards day by day
      let streak = 0;
      while(set.has(cur)){
        streak++;
        cur = prevDayISO(cur);
      }
      return streak;
    }

    function prevDayISO(iso){
      const [y,m,d] = iso.split("-").map(Number);
      const dt = new Date(y, m-1, d);
      dt.setDate(dt.getDate()-1);
      const pad = (n)=>String(n).padStart(2,"0");
      return `${dt.getFullYear()}-${pad(dt.getMonth()+1)}-${pad(dt.getDate())}`;
    }

    function refresh(){
      const entries = loadEntries();
      buildChart(entries);
      renderHistory(entries);
    }

    // ---------- Actions ----------
    function initHome(){
      const t = todayISO();
      $("#dateInput").value = t;
      $("#todayLabel").textContent = fmtDate(t);

      $("#dateInput").addEventListener("change", () => {
        $("#todayLabel").textContent = fmtDate($("#dateInput").value);
      });

      $("#saveBtn").addEventListener("click", () => {
        const date = $("#dateInput").value || todayISO();
        const w = Number($("#weightInput").value);
        if(!date){ alert("Choisis une date."); return; }
        if(!Number.isFinite(w) || w <= 0){
          alert("Entre un poids valide (ex: 78.4).");
          return;
        }
        const entries = upsertEntry(loadEntries(), date, Math.round(w*10)/10);
        saveEntries(entries);
        $("#weightInput").value = "";
        refresh();
        // quick feedback
        const btn = $("#saveBtn");
        const old = btn.textContent;
        btn.textContent = "Enregistr√© ‚úÖ";
        setTimeout(()=> btn.textContent = old, 900);
      });

      $("#clearBtn").addEventListener("click", () => {
        const ok = confirm("Tout effacer ? (pes√©es + checklist).");
        if(!ok) return;
        clearAll();
        refresh();
        initChecks();
      });

      $("#exportBtn").addEventListener("click", () => {
        const entries = loadEntries();
        const blob = new Blob([JSON.stringify(entries, null, 2)], {type:"application/json"});
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "fitmotiv-poids.json";
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);
      });
    }

    // ---------- Tabs ----------
    function initTabs(){
      $$(".tabBtn").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          $$(".tabBtn").forEach(b=>b.classList.remove("active"));
          btn.classList.add("active");

          const id = btn.dataset.tab;
          $$(".section").forEach(s=>s.classList.remove("active"));
          $("#"+id).classList.add("active");
        });
      });
    }

    // ---------- Boot ----------
    renderMeals();
    pickQuote();
    $("#newQuoteBtn").addEventListener("click", pickQuote);

    initTabs();
    initHome();
    initChecks();
    refresh();
  </script>
</body>
</html>